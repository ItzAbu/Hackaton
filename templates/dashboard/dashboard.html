<!doctype html>
{% load static %}
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UrbanKnowledge ‚Äî Dashboard Azienda</title>
  <link rel="stylesheet" href="{% static 'style.css' %}" />
</head>

<body>
  <!-- TOPBAR -->
  <header class="topbar">
    <div class="container topbar-inner">
      <a class="brand" href="/">
        <div class="logo" aria-hidden="true">
          <img src="{% static 'imgs/logo.png' %}" alt="Logo UrbanKnowledge">
        </div>
        <div>UrbanKnowledge</div>
      </a>

      <div class="topbar-right">
        <span class="badge success">Azienda</span>
        <div class="pill">Piano: {{ company_plan|default:"Gold" }}</div>
        <a class="btn btn-ghost" href="/">Home</a>
        <form method="post" action="{% url 'logout' %}" style="display:inline;">
            {% csrf_token %}
            <button class="btn btn-outline" type="submit">Logout</button>
        </form>
        <div class="avatar-dot" title="{{ user.username|default:'Admin' }}"></div>
      </div>
    </div>
  </header>

  <main>
    <section class="container" style="margin-top:18px;">
      <div class="card pad">
        <h2 class="h3" style="margin:0 0 6px 0;">Benvenuto, {{ user.username }}</h2>
        <p class="p" style="margin:0 0 14px 0;">
          Tipo account: <b>{{ profile.get_user_type_display }}</b>
          {% if profile.user_type == "COMPANY" and profile.company_name %} ‚Äî {{ profile.company_name }}{% endif %}
        </p>
        <div class="btn-row">
          <a class="btn btn-primary" href="{% url 'kaboom' %}">Avvia gioco (Kaboom)</a>
          <a class="btn btn-ghost" href="{% url 'logout' %}">Logout</a>
        </div>
      </div>
    </section>

    <div class="container app-body">
      <!-- SIDEBAR -->
      <aside class="card sidebar">
        <div class="panel-title">Pannello aziendale</div>

        <nav class="side-nav" aria-label="Menu azienda">
          <a class="side-link active" href="{% url 'dashboard' %}">
            Dashboard <span class="badge">‚Üó</span>
          </a>

          <!-- Le URL qui sotto sono placeholder: aggiornale con i tuoi name= nelle urls.py -->
          <a class="side-link" href="#dipendenti">
            Dipendenti <span class="badge">{{ employees_active|default:"24" }}</span>
          </a>
          <a class="side-link" href="#">
            Corsi <span class="badge">{{ courses_active|default:"3" }}</span>
          </a>
          <a class="side-link" href="#">
            Impostazioni <span class="badge">‚öô</span>
          </a>
        </nav>

        <hr class="sep" />

        <div class="help">
          <strong>Azioni rapide</strong><br>
          ‚Ä¢ Invita dipendenti<br>
          ‚Ä¢ Crea un corso<br>
          ‚Ä¢ Monitora i progressi
        </div>
      </aside>

      <!-- CONTENT -->
      <section class="card content">
        <div class="kpi">
          <div>
            <div class="kicker">üìä Overview</div>
            <h1 class="h2" style="margin-top:10px;">Dashboard Azienda</h1>
            <p class="p">Monitoraggio rapido di utilizzo, progressi e corsi attivi.</p>
          </div>
          <div style="text-align:right;">
            <span class="help">Ultimo aggiornamento</span><br>
            <strong>{{ last_update|default:"Oggi" }}</strong>
          </div>
        </div>

        <!-- KPI CARDS -->
        <div class="grid cols-4" style="margin-top:14px;">
          <div class="card pad" style="box-shadow:none; background: rgba(255,255,255,0.72);">
            <div class="badge success">Dipendenti</div>
            <div class="kpi" style="margin-top:10px;">
              <strong>{{ employees_active|default:"24" }}</strong>
              <span>attivi</span>
            </div>
            <div class="help">su {{ employees_limit|default:"100" }} disponibili</div>
          </div>

          <div class="card pad" style="box-shadow:none; background: rgba(255,255,255,0.72);">
            <div class="badge success">Completamento</div>
            <div class="kpi" style="margin-top:10px;">
              <strong>{{ completion_rate|default:"68" }}%</strong>
              <span>medio</span>
            </div>
            <div class="progress" style="margin-top:10px;">
              <div style="width: {{ completion_rate|default:'68' }}%"></div>
            </div>
          </div>

          <div class="card pad" style="box-shadow:none; background: rgba(255,255,255,0.72);">
            <div class="badge success">Corsi</div>
            <div class="kpi" style="margin-top:10px;">
              <strong>{{ courses_active|default:"3" }}</strong>
              <span>attivi</span>
            </div>
            <div class="help">max: {{ courses_limit|default:"5" }}</div>
          </div>

          <!-- <div class="card pad" style="box-shadow:none; background: rgba(255,255,255,0.72);">
            <div class="badge success">Citt√†</div>
            <div class="kpi" style="margin-top:10px;">
              <strong>{{ cities_count|default:"2" }}</strong>
              <span>generate</span>
            </div>
            <div class="help">max: {{ cities_limit|default:"5" }}</div>
          </div> -->
        </div>

        <hr class="sep" />

        <!-- SPLIT: progress + azioni -->
        <div class="split">
          <!-- Progressi -->
          <div class="card pad" style="box-shadow:none; background: rgba(255,255,255,0.66);">
            <div style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;">
              <div>
                <strong>Progressi per area</strong>
                <div class="help">Media aziendale</div>
              </div>
              <div class="btn-row">
                <a class="btn btn-outline" href="#">Esporta</a>
                <a class="btn btn-primary" href="#">Dettagli</a>
              </div>
            </div>

            <div style="margin-top:14px;">
              <div class="help"><strong>Matematica</strong><strong>70%</strong></div>
              <div class="progress"><div style="width:{{ math_progress|default:'72' }}%"></div></div>
            </div>

            <div style="margin-top:12px;">
              <div class="help"><strong>Informatica</strong><strong>60%</strong></div>
              <div class="progress"><div style="width:{{ cs_progress|default:'58' }}%"></div></div>
            </div>

            <div style="margin-top:12px;">
              <div class="help"><strong>Economia</strong><strong>65%</strong></div>
              <div class="progress"><div style="width:{{ econ_progress|default:'64' }}%"></div></div>
            </div>

            <div style="margin-top:12px;">
              <div class="help"><strong>Lingue</strong><strong>50%</strong></div>
              <div class="progress"><div style="width:{{ lang_progress|default:'49' }}%"></div></div>
            </div>
          </div>

          <!-- Azioni / Attivit√† -->
          <div class="card pad" style="box-shadow:none; background: rgba(255,255,255,0.66);">
            <strong>Attivit√† recente</strong>
            <div class="help">Ultime azioni</div>

            <table class="table" style="margin-top:12px;">
              <thead>
                <tr>
                  <th>Quando</th>
                  <th>Evento</th>
                  <th>Dettaglio</th>
                </tr>
              </thead>
              <tbody>
                {% for a in activities %}
                <tr>
                  <td>{{ a.when }}</td>
                  <td>{{ a.event }}</td>
                  <td>{{ a.detail }}</td>
                </tr>
                {% empty %}
                <tr>
                  <td>Oggi</td>
                  <td>Nuovo dipendente</td>
                  <td>Invitato: m.rossi@azienda.it</td>
                </tr>
                <tr>
                  <td>Ieri</td>
                  <td>Corso aggiornato</td>
                  <td>‚ÄúOnboarding IT‚Äù (nuove quest)</td>
                </tr>
                <tr>
                  <td>2 gg fa</td>
                  <td>Citt√† generata</td>
                  <td>‚ÄúMilano ‚Äî Base‚Äù</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>

            <div class="btn-row" style="margin-top:12px;">
              <a class="btn btn-primary" href="#">Invita dipendenti</a>
              <a class="btn btn-outline" href="#">Crea corso</a>
            </div>
          </div>
        </div>

        <hr class="sep" />

        <!-- Dipendenti (preview) -->
        <div id="dipendenti" class="card pad" style="box-shadow:none; background: rgba(255,255,255,0.66);">
          <div style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap; align-items:center;">
            <div>
              <strong>Dipendenti</strong>
              <div class="help">Top progressi</div>
            </div>
            <div class="btn-row">
              <a class="btn btn-ghost" href="#">Gestisci</a>
              <a class="btn btn-outline" href="#">Filtra</a>
            </div>
          </div>

          <table class="table" style="margin-top:12px;">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Livello</th>
                <th>XP</th>
                <th>Stato</th>
              </tr>
            </thead>
            <tbody>
              {% for e in employees %}
              <tr>
                <td>{{ e.name }}</td>
                <td>{{ e.level }}</td>
                <td>{{ e.xp }}</td>
                <td>
                  {% if e.active %}
                    <span class="badge success">Attivo</span>
                  {% else %}
                    <span class="badge warn">Inattivo</span>
                  {% endif %}
                </td>
              </tr>
              {% empty %}
              <tr>
                <td>Mario Rossi</td>
                <td>12</td>
                <td>3.240</td>
                <td><span class="badge success">Attivo</span></td>
              </tr>
              <tr>
                <td>Giulia Bianchi</td>
                <td>10</td>
                <td>2.850</td>
                <td><span class="badge success">Attivo</span></td>
              </tr>
              <tr>
                <td>Luca Verdi</td>
                <td>7</td>
                <td>1.640</td>
                <td><span class="badge warn">Inattivo</span></td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </section>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div>
        <strong>UrbanKnowledge</strong> ‚Äî ¬© 2025<br>
        <a href="#">Privacy</a> - <a href="#">Termini</a> - <a href="#">Supporto</a>
      </div>

      <div class="footer-links">
        <p><b>Contatti</b><br>
          <a href="mailto:info@urbanknowledge.it">info@urbanknowledge.it</a><br>
          <a href="tel:+393456789012">+39 345 678 9012</a><br>
          Via Esino 36, Ancona, Italia
        </p>
      </div>

      <div class="footer-links">
        <p><b>Team</b><br>
          Mattia Fermani<br>
          Abu Shahid Islam<br>
          Gabriele Papa<br>
          Samuel Sanchez<br>
          Matteo Scoccianti<br>
          Simone Vescovo
        </p>
      </div>
    </div>
  </footer>

</body>
</html>
