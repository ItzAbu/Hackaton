<!doctype html>
{% load static %}
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UrbanKnowledge â€” Area Privati</title>
  <link rel="stylesheet" href="{% static 'style.css' %}" />
</head>
<body>

  <header class="topbar">
    <div class="container topbar-inner">
      <a class="brand" href="/">
        <div class="logo" aria-hidden="true">
          <img src="{% static 'imgs/logo.png' %}" alt="Logo UrbanKnowledge">
        </div>
        <div>UrbanKnowledge</div>
      </a>

      <div class="topbar-right">
        <span class="badge">Privato</span>

        <!-- link rapido a search tab -->
        <a class="btn btn-ghost" href="{% url 'private_page' %}?tab=search">Search</a>

        <a class="btn btn-outline" href="{% url 'logout' %}">Logout</a>

        <a class="avatar-link" href="{% url 'private_profile' %}" title="Profilo">
          <div class="avatar-dot"></div>
        </a>
      </div>
    </div>
  </header>

  <main class="app">
    <section class="container" style="margin-top:18px;">
      <div class="card pad">
        <h2 class="h3" style="margin:0 0 6px 0;">
          Ciao, {{ user.username }} ðŸ‘‹
        </h2>
        <p class="p" style="margin:0;">Scegli dove vuoi andare.</p>
      </div>
    </section>

    <!-- âœ… â€œtabâ€ -->
    <section class="container" style="margin-top:16px;">
      <div class="grid cols-3">

        <a class="tile tab-tile {% if selected_tab == 'companies' %}is-active{% endif %}"
           href="{% url 'private_page' %}?tab=companies"
           data-tab="companies">
          <div class="card pad">
            <h3 class="h3" style="margin:0 0 6px 0;">Aziende</h3>
            <p class="p" style="margin:0;">Vedi i giochi dellâ€™azienda di cui fai parte.</p>
          </div>
        </a>

        <a class="tile tab-tile {% if selected_tab == 'discovery' %}is-active{% endif %}"
           href="{% url 'private_page' %}?tab=discovery"
           data-tab="discovery">
          <div class="card pad">
            <h3 class="h3" style="margin:0 0 6px 0;">Discovery</h3>
            <p class="p" style="margin:0;">Tutti i giochi disponibili (demo inclusa).</p>
          </div>
        </a>

        <a class="tile tab-tile {% if selected_tab == 'search' %}is-active{% endif %}"
           href="{% url 'private_page' %}?tab=search"
           data-tab="search">
          <div class="card pad">
            <h3 class="h3" style="margin:0 0 6px 0;">Search</h3>
            <p class="p" style="margin:0;">Inserisci un codice per aprire una mappa.</p>
          </div>
        </a>

      </div>
    </section>

    <!-- âœ… contenuto che cambia sotto -->
    <section class="container" style="margin-top:16px;">

      <!-- AZIENDE -->
      <div class="card pad tab-panel"
           data-panel="companies"
           {% if selected_tab != 'companies' %}hidden{% endif %}>
        <h2 class="h2" style="margin:0 0 8px 0;">Aziende</h2>
        <p class="p" style="margin:0;">
          Al momento <b>non fai parte di nessuna azienda</b>.
        </p>

        <div class="private-actions">
          <a class="btn btn-primary" href="{% url 'private_page' %}?tab=search">Inserisci codice (Search)</a>
          <a class="btn btn-ghost" href="{% url 'private_page' %}?tab=discovery">Vai a Discovery</a>
        </div>
      </div>

      <!-- DISCOVERY -->
      <div class="card pad tab-panel"
           data-panel="discovery"
           {% if selected_tab != 'discovery' %}hidden{% endif %}>
        <h2 class="h2" style="margin:0 0 8px 0;">Discovery</h2>
        <p class="p" style="margin:0 0 12px 0;">Per ora vedi solo la card di prova.</p>

        <a class="tile" href="{% url 'kaboom' %}">
          <div class="card pad game-card">
            <div class="meta">
              <div class="tag">Demo</div>
              <h3 class="h3" style="margin:0;">CittÃ  Prova</h3>
              <p class="p" style="margin:0;">Apri Kaboom (per ora Ã¨ lâ€™unico gioco visibile).</p>
            </div>
            <div>
              <span class="btn btn-primary">Apri</span>
            </div>
          </div>
        </a>
      </div>

      <!-- SEARCH -->
      <div class="card pad tab-panel"
           data-panel="search"
           {% if selected_tab != 'search' %}hidden{% endif %}>
        <h2 class="h2" style="margin:0 0 8px 0;">Search</h2>
        <p class="p" style="margin:0;">
          Inserisci un codice per aprire una mappa. (Per ora Ã¨ solo UI, non funziona.)
        </p>

        <form class="search-form" method="get" action="#">
          <input class="input" type="text" name="code" placeholder="Es. CITY-1234" />
          <button class="btn btn-primary" type="submit">Apri</button>
        </form>

        <p class="p" style="margin-top:10px; opacity:.8;">
          Suggerimento: in futuro qui potrai incollare un codice fornito dallâ€™azienda o da un QR.
        </p>
      </div>

    </section>
  </main>

  <script>
    // âœ… Cambio tab senza ricaricare (ma mantiene anche ?tab=...)
    (function(){
      const tiles = document.querySelectorAll(".tab-tile[data-tab]");
      const panels = document.querySelectorAll(".tab-panel[data-panel]");

      function setTab(tab){
        tiles.forEach(t => t.classList.toggle("is-active", t.dataset.tab === tab));
        panels.forEach(p => p.hidden = (p.dataset.panel !== tab));

        const url = new URL(window.location.href);
        url.searchParams.set("tab", tab);
        window.history.replaceState({}, "", url);
      }

      tiles.forEach(t => {
        t.addEventListener("click", (e) => {
          e.preventDefault();
          setTab(t.dataset.tab);
        });
      });

      // inizializza
      const urlTab = new URLSearchParams(window.location.search).get("tab");
      setTab(urlTab || "{{ selected_tab|default:'companies' }}");
    })();
  </script>

</body>
</html>
